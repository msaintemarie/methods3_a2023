---
title: "Assignment 1 (A1): Git Hub Configuration and Data Cleaning"
subtitle: 'Solutions'
output:
  html_document:
      toc: yes
      number_sections: no
      toc_float: yes
      theme: united
      highlight: espresso
      css: '../../varia/standard.css'
geometry: margin=1in
knit: (function(inputFile, encoding) {
  browseURL(
    rmarkdown::render(
      inputFile,
      encoding = encoding,
      output_dir = '../../varia/solutions',
      output_file = "a1.html"))})
bibliography: '../../varia/bibliography.bib'
---


The objective of this warm-up assignment is to brush up your programming and data wrangling skills as well as to introduce you to the data set you will be working on in Assignment 1. More precisely, you will here be asked here to do the following:

1. Introduction to version control
   - Create a **Github** (or **gitlab**) account
   - Link your **Git** account to your **RStudio**
   - Create a new repository/project
2. Introduction to the data set
3. Data Manipulation refresher
  - Transform several data sets into a single one
    - Filter data so as to keep only the variables needed for next assignments
    - Tidyverse packages (**stringr** and **dplyr**)

## A1.1: Let's get started on **GitHub**

In the assignments you will be asked to upload your code on **Github** and the **GitHub** repositories will be part of the portfolio, therefore all students must make an account and link it to their **RStudio** (you'll thank us later for this!).

- Install [latest **R** version](https://mirrors.dotsrc.org/cran/)
- Install [latest **RStudio** version](https://posit.co/download/rstudio-desktop/)

Follow the link to one of the tutorials indicated in the syllabus:

- [Happy Git with R](https://happygitwithr.com/)
- [Alternative1](https://support.rstudio.com/hc/en-us/articles/200532077-Version-Control-with-Git-and-SVN)
- [Alternative2](https://docs.google.com/document/d/1WvApy4ayQcZaLRpD6bvAqhWncUaPmmRimT016-PrLBk/mobilebasic)

N.B. Create a GitHub repository for the Assignment 1 and link it to a project on your **RStudio**.

## A1.2: Introduction to the dataset

**Project:** Language development in Autism Spectrum Disorder (ASD)

**Source:** [Fusaroli, Riccardo, Ethan Weed, Deborah Fein, and Letitia Naigles. 2019. “Hearing Me Hearing You: Reciprocal Effects Between Child and Parent Language in Autism and Typical Development.” Cognition 183: 1–18.](https://www.ncbi.nlm.nih.gov/pubmed/30396129)

**Background:** Autism Spectrum Disorder (ASD) is often related to language impairment, and language impairment strongly affects the patients ability to function socially (maintaining a social network, thriving at work, etc.). It is therefore crucial to understand how language abilities develop in children with ASD, and which factors affect them (to figure out e.g. how a child will develop in the future and whether there is a need for language therapy).

However, language impairment is always assessed by relying on the parent, teacher or clinician's subjective judgment of the child, and measured very sparsely (e.g. at 3 years old and again at 6). To help address this gap in clinical practice, we videotaped around 30 kids with ASD and around 30 comparison kids (matched by linguistic performance at visit 1) for approximately 30 minutes of naturalistic interactions with a parent. We repeated the data collection 6 times per kid at an interval of 4 months between each visit.

We transcribed the data and counted:

1. the amount of words that each kid uses in each video. Same for the parent.
2. the amount of unique words that each kid uses in each video. Same for the parent.
3. the amount of morphemes per utterance (Mean Length of Utterance) displayed by each child in each video. Same for the parent. 

Different data sets were built by the researchers involved in the project:

1) demographic and clinical data about the children (recorded by a clinical psychologist)
2) length of utterance data (calculated by a linguist)
3) amount of unique and total words used

Your job in this assignment is to double-check the data and make it analysis-ready for the next assignment, in which we will try to understand how children language development is a function of cognitive and social factors and how the latter can be used as "cues" to likely future language impairments.

## A1.3: Data Manipulation Refresher

If you have created a Rstudio project for this assignment, the working directory for this assignment (the default path for any function, procedure or command that works on files) is the project directory. If you have decided otherwise, first make sure that you set your working directory to the path of the current RMarkdown file. You can also use the following code chunk to install and/or load the packages you will need for the tasks below.

```{r setup}
pacman::p_load(tidyverse,
               janitor)
```

Load the following three data sets, after downloading them from dropbox and saving them in your working directory:

- Demographic data for the participants: https://www.dropbox.com/s/w15pou9wstgc8fe/demo_train.csv?dl=0
- Length of utterance data: https://www.dropbox.com/s/usyauqm37a76of6/LU_train.csv?dl=0
- Word data: https://www.dropbox.com/s/8ng1civpl2aux58/token_train.csv?dl=0

```{r, message = FALSE}
Demo <- read_csv('../../../data/demo_train.csv')
LU <- read_csv('../../../data/LU_train.csv')
Word <- read_csv('../../../data/token_train.csv')
```

Explore the 3 data sets (e.g. visualize them, summarize them, etc.). You will see that the data is messy, since the psychologist collected the demographic data, the linguist analyzed the length of utterance in May 2014 and the fumbling jack-of-all-trades analyzed the words several months later. 
In particular:
- the same variables might have different names (e.g. participant and visit identifiers)
- the same variables might report the values in different ways (e.g. participant and visit IDs)
Welcome to real world of messy data :-)

Before being able to combine the data sets we need to make sure the relevant variables have the same names and the same kind of values.

So:

**1. Identify which variable names do not match (that is are spelled differently) and find a way to transform variable names.**

Pay particular attention to the variables indicating participant and visit.

**Tip:** look through the chapter on data transformation in [R for data science](http://r4ds.had.co.nz). Alternatively you can look into the package **dplyr** (part of tidyverse), or google "how to rename variables in R". Or check the **janitor** R package. There are always multiple ways of solving any problem and no absolute best method.


```{r}
compare_df_cols(LU,
                Word,
                Demo)

Speech <- merge(LU, Word) %>% 
  rename(Child.ID = SUBJ, Visit = VISIT)

compare_df_cols(Speech, Demo)
```

**2. Find a way to homogenize the way "visit" is reported (visit1 vs. 1).**

**Tip:** The **stringr** package is what you need. **str_extract ()** will allow you to extract only the digit (number) from a string, by using the regular expression \\d.


```{r}
Speech$Visit <- as.integer(str_extract(Speech$Visit, "\\d"))
```

**3. We also need to make a small adjustment to the content of the Child.ID column in the demographic data.**

Within this column, names that are not abbreviations do not end with "." (i.e. Adam), which is the case in the other two data sets (i.e. Adam.). If The content of the two variables isn't identical the rows will not be merged.
A neat way to solve the problem is simply to remove all "." in all data sets.

**Tip:** stringr is helpful again. Look up **str_replace_all()**
**Tip:** You can either have one line of code for each child name that is to be changed (easier, more typing) or specify the pattern that you want to match (more complicated: look up "regular expressions", but less typing)


```{r}
### one-liner
Speech$Child.ID <-  str_replace_all(Speech$Child.ID,"\\.", "")

Demo$Child.ID <-  str_replace_all(Demo$Child.ID,"\\.", "")


```

**4. Make a subset of each data set only containing the variables that we wish to use in the final data set.**


For this we use the **tidyverse** package **dplyr**, which contains the function **select()**. 

The variables we need are:

* Child.ID, 
* Visit, 
* Diagnosis, 
* Ethnicity, 
* Gender, 
* Age, 
* ADOS,  
* MullenRaw, 
* ExpressiveLangRaw, 
* Socialization
* MOT_MLU, 
* CHI_MLU, 
* types_MOT, 
* types_CHI, 
* tokens_MOT, 
* tokens_CHI.

Most variables names should make sense, that is, should give a good idea of the information it contains. Here are the less intuitive ones among the ones listed above.

* *ADOS* (Autism Diagnostic Observation Schedule) indicates the severity of the autistic symptoms (the higher the score, the worse the symptoms). Ref: https://link.springer.com/article/10.1023/A:1005592401947
* *MLU* stands for mean length of utterance
* *types* stands for unique words (e.g. even if "doggie" is used 100 times it only counts for 1)
* *tokens* stands for overall amount of words (if "doggie" is used 100 times it counts for 100) 
* *MullenRaw* indicates non verbal IQ, as measured by Mullen Scales of Early Learning (MSEL https://link.springer.com/referenceworkentry/10.1007%2F978-1-4419-1698-3_596)
* *E*xpressiveLangRaw* indicates verbal IQ, as measured by MSEL
* *Socialization* indicates social interaction skills and social responsiveness, as measured by Vineland (https://cloudfront.ualberta.ca/-/media/ualberta/faculties-and-programs/centres-institutes/community-university-partnership/resources/tools---assessment/vinelandjune-2012.pdf)

Feel free to rename the variables into something you think is more intuitive (i.e. *nonVerbalIQ*, *verbalIQ*)

```{r}

Demo <- Demo %>% 
  select(c("Child.ID", "Visit", "Ethnicity", "Diagnosis", "Gender", "Age", "ADOS", "MullenRaw", "ExpressiveLangRaw","Socialization"))
Speech <- Speech %>% 
  select(c("Child.ID", "Visit", "MOT_MLU", "CHI_MLU", "types_MOT", "types_CHI", "tokens_MOT", "tokens_CHI"))
```

**5. Finally we are ready to merge all the data sets into just one.**

Some things to pay attention to:

* make sure to check that the merge has included all relevant data (e.g. by comparing the number of rows)
* make sure to understand whether (and if so why) there are NAs in the data set (e.g. some measures were not taken at all visits, some recordings were lost or permission to use was withdrawn)

```{r}
Data <- merge(Demo, Speech, all = T)

```

**6. Only using clinical measures from Visit 1**

In order for our models to be useful, we want to minimize the need to actually test children as they develop. In other words, we would like to be able to understand and predict the children's linguistic development after only having tested them once. Therefore we need to make sure that our *ADOS*, *MullenRaw*, *ExpressiveLangRaw* and *Socialization* variables are reporting (for all visits) only the scores from visit 1.

A possible way to do so:

* create a new data set with only *visit 1*, *child.ID* and the 4 relevant clinical variables to be merged with the old dataset
* rename the clinical variables (e.g. *ADOS* to *ADOS1*) and remove the visit (so that the new clinical variables are reported for all 6 visits)
* merge the new data set with the old



```{r}
Data1 <- Data %>% 
  subset(Visit == 1) %>% 
  select(Child.ID,
         ADOS1 = ADOS,
         verbalIQ1 = ExpressiveLangRaw,
         nonVerbalIQ1 = MullenRaw,
         Socialization1 = Socialization)
  
Data <- merge(Data,Data1, all = T)
```

**7. Reverse Encoding**

An important part of data cleaning is making sure both variable names and value allow for easy and intuitive analysis and interpretation. For example, the different values for the categorical variable *gender* have been encoded to '1' and '2', but these numbers are useless to anyone who doesn't have the proper encoding dictionary, which maps each number to the corresponding category, namely 'male' or 'female'. In the following code chunk, resolve this ambiguity by reversing the encoding of the gender variable, so that 1 and 2 are changed to F and M respectively. In the same vein, transform the 'Diagnosis' variable so that 'A's and 'B's are reverted back to ASD (Autism Spectrum Disorder) and TD (typically developing) respectively.

```{r revert_encoding}
Data <- Data %>%
  mutate(
    Child.ID = as.numeric(as.factor(as.character(Child.ID))),
    Visit = as.numeric(as.character(Visit)),
    Gender = recode(Gender, 
                    "1" = "Male",
                    "2" = "Female"),
    Diagnosis = recode(Diagnosis,
                       "A"  = "ASD",
                       "B"  = "TD"))
```

**8. Saving cleaned data**

Finally, save the cleaned data in Comma-Separated Values (CSV) format, under a name and at a location of your own choosing.

```{r save_changes}

write_csv(Data, "cleaned_data.csv")

```

Your data is now ready for the next assignement!